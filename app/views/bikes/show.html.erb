<h1>Bike Information</h1>

<%= render :partial=>"bike_table", :layout=>"bike_table_layout" %>

<p><%= link_to "Edit information", edit_bike_path(bike) %> </p>

<h2>Location</h2>
<% if bike.departed? %>
<p>Bike has departed.</p>
<% else %>
  <% if bike.hook %>
	<p>Bike <%= bike.number %> is on hook: <%= bike.hook.number %>.</p>
	<p>Choose "Free Hook" to remove this bike from its hook.</p>
	<%= form_for(hook, :url => vacate_hook_bike_path(bike), :method=>:put) do |f| %>
	<%= f.submit "Free hook" %>
	<% end %>
  <% else %>
	<p>No location is assigned to bike <%= bike.number %>.</p>
	<% if hook %>
	<%= form_for(hook, :url => reserve_hook_bike_path(bike), :method=>:put) do |f| %>
	<%= label_tag(:hook_id, "Select an available hook:") %>
	<%= select_tag(:hook_id, options_from_collection_for_select(Hook.available, :id, :number)) %>
	<%= f.submit "Reserve hook" %>
	<% end %>
	<% else %>
	<p>No hooks are available.</p>
	<% end %>
  <% end %>
<% end %>

<h2>Project Info</h2>
<% if bike.project %>
<p>This bike is currently a <%= bike.project.category_name %> project</p>
<p><%= link_to "View project details", project_path(bike.project) %>
<% elsif bike.available? %>
  <p>This bike is available</p>
  <%= form_for(project, :url => projects_path, :method => :post) do |f| %>
  <%= hidden_field_tag(:bike_id, bike.id) %>
  <%= select_tag(:program_id, options_from_collection_for_select(Program.all, :id, :title)) %>
  <%= f.submit "Start project" %>
  <% end %>

<% else %>
<p>Bike is unavailable.</p>

<% end %>

<h2>Departure Info</h2>
<% if bike.departed? %>
Departed on <%= bike.departed_at.strftime('%d %B %y') %>
<% else %>

  <% strBtnText=(bike.project)?"Close project and send away" : "Send away" %>
  <%= form_for(bike, :url=>send_away_bike_path(bike), :method => :put) do |f| %>
    <%= f.submit(strBtnText) %>
  <% end %>


<% end %>

<h2><%= pluralize(bike.comment_threads.length, 'Note') %></h2>
<%= render :partial=>"comments/index", :locals=>{:comments => bike.comment_threads} %>
<br />
<%= render :partial=>"comments/form", :locals=>{:url => new_comment_bike_path(@bike)} %>
